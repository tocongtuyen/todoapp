var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");var _interopRequireWildcard=require("@babel/runtime/helpers/interopRequireWildcard");Object.defineProperty(exports,"__esModule",{value:true});exports.default=void 0;var _defineProperty2=_interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));var _classCallCheck2=_interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));var _createClass2=_interopRequireDefault(require("@babel/runtime/helpers/createClass"));var _inherits2=_interopRequireDefault(require("@babel/runtime/helpers/inherits"));var _possibleConstructorReturn2=_interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn"));var _getPrototypeOf2=_interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf"));var _react=_interopRequireWildcard(require("react"));var _reactNative=require("react-native");var _headercomponent=_interopRequireDefault(require("../components/headercomponent.js"));var _taskcomponent=_interopRequireDefault(require("../components/taskcomponent.js"));var _Fontisto=_interopRequireDefault(require("react-native-vector-icons/Fontisto"));var _firebase=_interopRequireDefault(require("../database/firebase"));var _reactNativeActionsheet=_interopRequireDefault(require("react-native-actionsheet"));var _reactNativeDialog=_interopRequireDefault(require("react-native-dialog"));var _jsxFileName="/Users/tuyento/ReactNative/KhoaLuan/todoapp/src/screens/taskscreen.js";function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly)symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable;});keys.push.apply(keys,symbols);}return keys;}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};if(i%2){ownKeys(Object(source),true).forEach(function(key){(0,_defineProperty2.default)(target,key,source[key]);});}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source));}else{ownKeys(Object(source)).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key));});}}return target;}function _createSuper(Derived){var hasNativeReflectConstruct=_isNativeReflectConstruct();return function _createSuperInternal(){var Super=(0,_getPrototypeOf2.default)(Derived),result;if(hasNativeReflectConstruct){var NewTarget=(0,_getPrototypeOf2.default)(this).constructor;result=Reflect.construct(Super,arguments,NewTarget);}else{result=Super.apply(this,arguments);}return(0,_possibleConstructorReturn2.default)(this,result);};}function _isNativeReflectConstruct(){if(typeof Reflect==="undefined"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy==="function")return true;try{Date.prototype.toString.call(Reflect.construct(Date,[],function(){}));return true;}catch(e){return false;}}var TaskScreen=function(_Component){(0,_inherits2.default)(TaskScreen,_Component);var _super=_createSuper(TaskScreen);function TaskScreen(props){var _this;(0,_classCallCheck2.default)(this,TaskScreen);_this=_super.call(this,props);_this.showDialog=function(){_this.setState({dialogVisible:true});};_this.handleCancel=function(){_this.setState({dialogVisible:false});};_this.handleSave=function(){_this.setState({dialogVisible:false});_this.addTask();};_this.getTaskByGroupId=function(id){return _firebase.default.firestore().collection('tasks').where('userid','==',id+'').get().then(function(querySnapshot){return querySnapshot.docs.map(function(i){return _objectSpread({key:i.id},i.data());});}).catch(function(error){console.log(error);return[];});};_this.updateStatusTask=function(item){var updateDBRef=_firebase.default.firestore().collection('tasks').doc(item.key);updateDBRef.set({userid:item.userid,iscompleted:!item.iscompleted,taskname:item.taskname,time:item.time,color:item.color}).then(function(docRef){_this.refreshTask();}).catch(function(error){console.error('Error: ',error);_this.setState({isLoading:false});});};_this.updateTaskImportant=function(item){var updateDBRef=_firebase.default.firestore().collection('tasks').doc(item.key);updateDBRef.set({userid:item.userid,iscompleted:item.iscompleted,isimportant:!item.isimportant,taskname:item.taskname,time:item.time}).then(function(docRef){_this.refreshTask();}).catch(function(error){console.error('Error: ',error);_this.setState({isLoading:false});});};_this.deleteTask=function(key){var dbRef=_firebase.default.firestore().collection('tasks').doc(key);dbRef.delete().then(function(res){console.log('Item removed from database');_this.refreshTask();});};_this.state={userid:'',title:'',dialogVisible:false,time:'',taskname:'',taskArr:[],keyTaskCurrent:''};return _this;}(0,_createClass2.default)(TaskScreen,[{key:"addTask",value:function addTask(){var _this2=this;if(this.state.taskname===''){alert('Fill at least your name!');}else{this.setState({isLoading:true});_firebase.default.firestore().collection('tasks').add({userid:this.state.userid,iscompleted:false,taskname:this.state.taskname,time:_firebase.default.firestore.FieldValue.serverTimestamp()}).then(function(res){_this2.refreshTask();}).catch(function(err){console.error('Error found: ',err);});}}},{key:"refreshTask",value:function refreshTask(){var _this3=this;this.getTaskByGroupId(this.state.userid).then(function(tasks){_this3.setState({taskArr:tasks});});}},{key:"componentDidMount",value:function componentDidMount(){var _this4=this;var userid=this.props.route.params.userid;this.setState({userid:userid},function(){console.log('====================================');console.log(_this4.state.userid);console.log('====================================');_this4.refreshTask();});}},{key:"render",value:function render(){var _this5=this;return _react.default.createElement(_reactNative.View,{style:styles.screenContainer,__source:{fileName:_jsxFileName,lineNumber:169,columnNumber:13}},_react.default.createElement(_headercomponent.default,{title:"",iconLeft:"arrow-left",iconRight:"ellipsis1",onLeftPress:function onLeftPress(){return _this5.props.navigation.goBack();},__source:{fileName:_jsxFileName,lineNumber:170,columnNumber:17}}),_react.default.createElement(_reactNative.Text,{style:styles.textStyle,__source:{fileName:_jsxFileName,lineNumber:176,columnNumber:17}},"Danh s\xE1ch c\xF4ng vi\u1EC7c"),_react.default.createElement(_reactNative.ScrollView,{__source:{fileName:_jsxFileName,lineNumber:177,columnNumber:17}},_react.default.createElement(_reactNative.FlatList,{data:this.state.taskArr,renderItem:function renderItem(_ref){var item=_ref.item;return _react.default.createElement(_taskcomponent.default,{name:item.taskname,time:item.time,iscompleted:item.iscompleted,color:item.color,onRightPress:function onRightPress(){_this5.setState({keyTaskCurrent:item.key});_this5.ActionSheet.show();},onClick:function onClick(){_this5.props.navigation.navigate('DetailTask',{item:item});},onCheckStatus:function onCheckStatus(){return _this5.updateStatusTask(item);},__source:{fileName:_jsxFileName,lineNumber:181,columnNumber:29}});},keyExtractor:function keyExtractor(item){return item.key;},__source:{fileName:_jsxFileName,lineNumber:178,columnNumber:21}}),_react.default.createElement(_reactNativeActionsheet.default,{ref:function ref(o){return _this5.ActionSheet=o;},title:'Dữ liệu sẽ bị xoá vĩnh viễn!',options:['Xoá công việc','Huỷ bỏ'],cancelButtonIndex:1,destructiveButtonIndex:0,onPress:function onPress(index){if(index==0){_this5.deleteTask(_this5.state.keyTaskCurrent);}},__source:{fileName:_jsxFileName,lineNumber:207,columnNumber:21}})),_react.default.createElement(_reactNative.TouchableOpacity,{style:styles.itemContainer,onPress:function onPress(){_this5.showDialog();console.log(_this5.state.dialogVisible);},__source:{fileName:_jsxFileName,lineNumber:220,columnNumber:17}},_react.default.createElement(_Fontisto.default,{name:"plus-a",size:30,color:"gray",__source:{fileName:_jsxFileName,lineNumber:227,columnNumber:21}}),_react.default.createElement(_reactNative.Text,{style:[styles.itemText,{marginLeft:20,color:'gray'}],__source:{fileName:_jsxFileName,lineNumber:228,columnNumber:21}},"Th\xEAm c\xF4ng vi\u1EC7c m\u1EDBi")),_react.default.createElement(_reactNativeDialog.default.Container,{visible:this.state.dialogVisible,__source:{fileName:_jsxFileName,lineNumber:238,columnNumber:17}},_react.default.createElement(_reactNativeDialog.default.Title,{__source:{fileName:_jsxFileName,lineNumber:239,columnNumber:21}},"Th\xEAm c\xF4ng vi\u1EC7c m\u1EDBi"),_react.default.createElement(_reactNativeDialog.default.Input,{placeholder:"Nh\u1EADp t\xEAn c\xF4ng vi\u1EC7c",onChangeText:function onChangeText(text){console.log(text);_this5.setState({taskname:text});},__source:{fileName:_jsxFileName,lineNumber:240,columnNumber:21}}),_react.default.createElement(_reactNativeDialog.default.Button,{label:"Hu\u1EF7 ",onPress:this.handleCancel,__source:{fileName:_jsxFileName,lineNumber:247,columnNumber:21}}),_react.default.createElement(_reactNativeDialog.default.Button,{label:"L\u01B0u",onPress:this.handleSave,__source:{fileName:_jsxFileName,lineNumber:248,columnNumber:21}})));}}]);return TaskScreen;}(_react.Component);exports.default=TaskScreen;var styles=_reactNative.StyleSheet.create({screenContainer:{flex:1},bodyContainer:{flex:1,backgroundColor:'#ededed'},container:{flex:1,display:'flex',justifyContent:'center',alignItems:'center',padding:35,backgroundColor:'#fff'},textStyle:{fontSize:35,fontWeight:'500',paddingVertical:10,paddingHorizontal:10},itemContainer:{backgroundColor:'#fff',flexDirection:'row',paddingHorizontal:20,paddingVertical:15,alignItems:'center'},itemText:{flex:1,color:'#1e1e1e',fontSize:22}});