var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");var _interopRequireWildcard=require("@babel/runtime/helpers/interopRequireWildcard");Object.defineProperty(exports,"__esModule",{value:true});exports.default=void 0;var _defineProperty2=_interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));var _classCallCheck2=_interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));var _createClass2=_interopRequireDefault(require("@babel/runtime/helpers/createClass"));var _inherits2=_interopRequireDefault(require("@babel/runtime/helpers/inherits"));var _possibleConstructorReturn2=_interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn"));var _getPrototypeOf2=_interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf"));var _react=_interopRequireWildcard(require("react"));var _reactNative=require("react-native");var _moment=_interopRequireDefault(require("moment"));var _taskitem=_interopRequireDefault(require("../components/taskitem.js"));var _headercomponent=_interopRequireDefault(require("../components/headercomponent.js"));var _reactNativeModalDatetimePicker=_interopRequireDefault(require("react-native-modal-datetime-picker"));var _firebase=_interopRequireDefault(require("../database/firebase"));var _reactNativeActionsheet=_interopRequireDefault(require("react-native-actionsheet"));var _jsxFileName="/Users/tuyento/ReactNative/KhoaLuan/todoapp/src/screens/tasklist.js";function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly)symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable;});keys.push.apply(keys,symbols);}return keys;}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};if(i%2){ownKeys(Object(source),true).forEach(function(key){(0,_defineProperty2.default)(target,key,source[key]);});}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source));}else{ownKeys(Object(source)).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key));});}}return target;}function _createSuper(Derived){var hasNativeReflectConstruct=_isNativeReflectConstruct();return function _createSuperInternal(){var Super=(0,_getPrototypeOf2.default)(Derived),result;if(hasNativeReflectConstruct){var NewTarget=(0,_getPrototypeOf2.default)(this).constructor;result=Reflect.construct(Super,arguments,NewTarget);}else{result=Super.apply(this,arguments);}return(0,_possibleConstructorReturn2.default)(this,result);};}function _isNativeReflectConstruct(){if(typeof Reflect==="undefined"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy==="function")return true;try{Date.prototype.toString.call(Reflect.construct(Date,[],function(){}));return true;}catch(e){return false;}}var _Dimensions$get=_reactNative.Dimensions.get('window'),vw=_Dimensions$get.width;var tasklist=function(_Component){(0,_inherits2.default)(tasklist,_Component);var _super=_createSuper(tasklist);function tasklist(props){var _this;(0,_classCallCheck2.default)(this,tasklist);_this=_super.call(this,props);_this.getTaskByGroupId=function(id){return _firebase.default.firestore().collection('tasks').where('userid','==',id+'').get().then(function(querySnapshot){return querySnapshot.docs.map(function(i){return _objectSpread({key:i.id},i.data());});}).catch(function(error){console.log(error);return[];});};_this.getTask=function(id){_firebase.default.firestore().collection('tasks').where('userid','==',id+'').onSnapshot(function(querySnapshot){var todoList=[];querySnapshot.forEach(function(doc){todoList.push(_objectSpread({key:doc.id},doc.data()));});console.log(todoList);_this.setState({todoList:todoList});});};_this.onSelect=function(data){_this.setState(data);};_this.deleteTask=function(key){var dbRef=_firebase.default.firestore().collection('tasks').doc(key);dbRef.delete().then(function(res){console.log('Item removed from database');_this.refreshTask();});};_this.state={userid:_this.props.route.params.userid,datesWhitelist:[{start:(0,_moment.default)(),end:(0,_moment.default)().add(365,'days')}],todoList:[],markedDate:[],currentDate:(0,_moment.default)().format('YYYY')+"-"+(0,_moment.default)().format('MM')+"-"+(0,_moment.default)().format('DD'),isModalVisible:false,selectedTask:null,isDateTimePickerVisible:false,keyTaskCurrent:''};return _this;}(0,_createClass2.default)(tasklist,[{key:"refreshTask",value:function refreshTask(){var _this2=this;this.getTaskByGroupId(this.state.userid).then(function(tasks){_this2.setState({todoList:tasks},function(){console.log('=========');console.log(_this2.state.todoList);});});}},{key:"componentDidMount",value:function componentDidMount(){this.getTask(this.state.userid);}},{key:"render",value:function render(){var _this3=this;var _this$state=this.state,userid=_this$state.userid,datesWhitelist=_this$state.datesWhitelist,markedDate=_this$state.markedDate,todoList=_this$state.todoList,isModalVisible=_this$state.isModalVisible,selectedTask=_this$state.selectedTask,isDateTimePickerVisible=_this$state.isDateTimePickerVisible,currentDate=_this$state.currentDate,navigation=this.props.navigation;return _react.default.createElement(_reactNative.View,{style:{flex:1},__source:{fileName:_jsxFileName,lineNumber:120,columnNumber:13}},_react.default.createElement(_reactNative.View,{style:styles.backButton,__source:{fileName:_jsxFileName,lineNumber:126,columnNumber:17}},_react.default.createElement(_reactNative.TouchableOpacity,{onPress:function onPress(){return _this3.props.navigation.goBack();},style:{marginRight:vw/2-120,marginLeft:20},__source:{fileName:_jsxFileName,lineNumber:127,columnNumber:21}},_react.default.createElement(_reactNative.Image,{style:{height:25,width:40},source:require('../assets/back.png'),resizeMode:"contain",__source:{fileName:_jsxFileName,lineNumber:131,columnNumber:25}})),_react.default.createElement(_reactNative.Text,{style:styles.newTask,__source:{fileName:_jsxFileName,lineNumber:138,columnNumber:21}},"Danh s\xE1ch")),_react.default.createElement(_reactNative.TouchableOpacity,{onPress:function onPress(){_this3.props.navigation.navigate('Addtask',{userid:_this3.state.userid,onSelect:_this3.onSelect});},style:styles.viewTask,__source:{fileName:_jsxFileName,lineNumber:141,columnNumber:17}},_react.default.createElement(_reactNative.Image,{source:require('../assets/plus.png'),style:{height:30,width:30},__source:{fileName:_jsxFileName,lineNumber:150,columnNumber:21}})),_react.default.createElement(_reactNative.View,{style:{width:'100%',height:_reactNative.Dimensions.get('window').height-170},__source:{fileName:_jsxFileName,lineNumber:159,columnNumber:17}},_react.default.createElement(_reactNative.ScrollView,{contentContainerStyle:{paddingBottom:20},__source:{fileName:_jsxFileName,lineNumber:165,columnNumber:21}},_react.default.createElement(_reactNative.View,{style:{marginTop:20},__source:{fileName:_jsxFileName,lineNumber:170,columnNumber:25}},_react.default.createElement(_reactNative.FlatList,{data:this.state.todoList,renderItem:function renderItem(_ref){var item=_ref.item;return _react.default.createElement(_reactNative.TouchableOpacity,{onPress:function onPress(){console.log(item.time.toDate());_this3.props.navigation.navigate('UpdateTask',{taskid:item.key});},key:item.key,__source:{fileName:_jsxFileName,lineNumber:174,columnNumber:37}},_react.default.createElement(_taskitem.default,{title:item.title,color:item.color,time:item.time.toDate(),notes:item.notes,onRightPress:function onRightPress(){_this3.setState({keyTaskCurrent:item.key});_this3.ActionSheet.show();},__source:{fileName:_jsxFileName,lineNumber:186,columnNumber:41}}));},keyExtractor:function keyExtractor(item){return item.key;},__source:{fileName:_jsxFileName,lineNumber:171,columnNumber:29}}),_react.default.createElement(_reactNativeActionsheet.default,{ref:function ref(o){return _this3.ActionSheet=o;},title:'Dữ liệu sẽ bị xoá vĩnh viễn!',options:['Xoá công việc','Huỷ bỏ'],cancelButtonIndex:1,destructiveButtonIndex:0,onPress:function onPress(index){if(index==0){_this3.deleteTask(_this3.state.keyTaskCurrent);}},__source:{fileName:_jsxFileName,lineNumber:203,columnNumber:29}})))));}}]);return tasklist;}(_react.Component);exports.default=tasklist;var styles=_reactNative.StyleSheet.create({taskListContent:{height:100,width:327,alignSelf:'center',borderRadius:10,shadowColor:'#2E66E7',backgroundColor:'#ffffff',marginTop:10,marginBottom:10,shadowOffset:{width:3,height:3},shadowRadius:5,shadowOpacity:0.2,elevation:3,flexDirection:'row',justifyContent:'space-between',alignItems:'center'},viewTask:{position:'absolute',bottom:40,right:17,height:60,width:60,backgroundColor:'#2E66E7',borderRadius:30,justifyContent:'center',alignItems:'center',shadowColor:'#2E66E7',shadowOffset:{width:0,height:5},shadowRadius:30,shadowOpacity:0.5,elevation:5,zIndex:999},deleteButton:{backgroundColor:'#ff6347',width:100,height:38,alignSelf:'center',marginTop:40,borderRadius:5,justifyContent:'center'},updateButton:{backgroundColor:'#2E66E7',width:100,height:38,alignSelf:'center',marginTop:40,borderRadius:5,justifyContent:'center',marginRight:20},sepeerator:{height:0.5,width:'100%',backgroundColor:'#979797',alignSelf:'center',marginVertical:20},notesContent:{height:0.5,width:'100%',backgroundColor:'#979797',alignSelf:'center',marginVertical:20},learn:{height:23,width:51,backgroundColor:'#F8D557',justifyContent:'center',borderRadius:5},design:{height:23,width:59,backgroundColor:'#62CCFB',justifyContent:'center',borderRadius:5,marginRight:7},readBook:{height:23,width:83,backgroundColor:'#4CD565',justifyContent:'center',borderRadius:5,marginRight:7},title:{height:25,borderColor:'#5DD976',borderLeftWidth:1,paddingLeft:8,fontSize:19},taskContainer:{height:475,width:327,alignSelf:'center',borderRadius:20,shadowColor:'#2E66E7',backgroundColor:'#ffffff',shadowOffset:{width:3,height:3},shadowRadius:20,shadowOpacity:0.2,elevation:5,padding:22},backButton:{flexDirection:'row',marginTop:60,width:'100%',alignItems:'center'},newTask:{alignSelf:'center',fontSize:20,width:120,height:25,textAlign:'center'},cardMain:{position:'absolute',top:100,width:327,borderRadius:20,backgroundColor:'#ffffff',alignSelf:'center'},container:{flex:1,backgroundColor:'rgba(0,0,0,0.5)'}});