var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");var _interopRequireWildcard=require("@babel/runtime/helpers/interopRequireWildcard");Object.defineProperty(exports,"__esModule",{value:true});exports.default=void 0;var _defineProperty2=_interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));var _classCallCheck2=_interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));var _createClass2=_interopRequireDefault(require("@babel/runtime/helpers/createClass"));var _inherits2=_interopRequireDefault(require("@babel/runtime/helpers/inherits"));var _possibleConstructorReturn2=_interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn"));var _getPrototypeOf2=_interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf"));var _react=_interopRequireWildcard(require("react"));var _reactNative=require("react-native");var _firebase=_interopRequireDefault(require("../database/firebase"));var _MaterialCommunityIcons=_interopRequireDefault(require("react-native-vector-icons/MaterialCommunityIcons"));var _Entypo=_interopRequireDefault(require("react-native-vector-icons/Entypo"));var _FontAwesome=_interopRequireDefault(require("react-native-vector-icons/FontAwesome"));var _reactNativeDialog=_interopRequireDefault(require("react-native-dialog"));var _reactNativeActionsheet=_interopRequireDefault(require("react-native-actionsheet"));var _headercomponent=_interopRequireDefault(require("../components/headercomponent.js"));var _grouptaskcomponent=_interopRequireDefault(require("../components/grouptaskcomponent.js"));var _jsxFileName="/Users/tuyento/ReactNative/KhoaLuan/todoapp/src/screens/dashboard.js";function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly)symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable;});keys.push.apply(keys,symbols);}return keys;}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};if(i%2){ownKeys(Object(source),true).forEach(function(key){(0,_defineProperty2.default)(target,key,source[key]);});}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source));}else{ownKeys(Object(source)).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key));});}}return target;}function _createSuper(Derived){var hasNativeReflectConstruct=_isNativeReflectConstruct();return function _createSuperInternal(){var Super=(0,_getPrototypeOf2.default)(Derived),result;if(hasNativeReflectConstruct){var NewTarget=(0,_getPrototypeOf2.default)(this).constructor;result=Reflect.construct(Super,arguments,NewTarget);}else{result=Super.apply(this,arguments);}return(0,_possibleConstructorReturn2.default)(this,result);};}function _isNativeReflectConstruct(){if(typeof Reflect==="undefined"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy==="function")return true;try{Date.prototype.toString.call(Reflect.construct(Date,[],function(){}));return true;}catch(e){return false;}}var ProfileItem=function ProfileItem(_ref){var icon=_ref.icon,name=_ref.name,onPress=_ref.onPress;return _react.default.createElement(_reactNative.TouchableOpacity,{style:styles.itemContainer,onPress:onPress,__source:{fileName:_jsxFileName,lineNumber:26,columnNumber:5}},_react.default.createElement(_MaterialCommunityIcons.default,{name:icon,size:30,color:"#1e1e1e",__source:{fileName:_jsxFileName,lineNumber:27,columnNumber:9}}),_react.default.createElement(_reactNative.Text,{style:[styles.itemText,{marginLeft:icon?20:0}],__source:{fileName:_jsxFileName,lineNumber:28,columnNumber:9}},name),_react.default.createElement(_FontAwesome.default,{name:"angle-right",size:26,color:"#1e1e1e",__source:{fileName:_jsxFileName,lineNumber:31,columnNumber:9}}));};var Dashboard=function(_Component){(0,_inherits2.default)(Dashboard,_Component);var _super=_createSuper(Dashboard);function Dashboard(props){var _this;(0,_classCallCheck2.default)(this,Dashboard);_this=_super.call(this,props);_this.signOut=function(){_firebase.default.auth().signOut().then(function(){_this.props.navigation.navigate('Login');}).catch(function(error){return _this.setState({errorMessage:error.message});});};_this.showDialog=function(){_this.setState({dialogVisible:true});};_this.handleCancel=function(){_this.setState({dialogVisible:false});};_this.handleSave=function(){_this.setState({dialogVisible:false});_this.storeGroup();};_this.getGroupByUserId=function(id){return _firebase.default.firestore().collection('groups').where('userid','==',id+'').orderBy('timestamp').get().then(function(querySnapshot){return querySnapshot.docs.map(function(i){return _objectSpread({key:i.id},i.data());});}).catch(function(error){console.log(error);return[];});};_this.deleteGroup=function(key){var dbRef=_firebase.default.firestore().collection('groups').doc(key);dbRef.delete().then(function(res){console.log('Item removed from database');_this.refreshGroup();});};_this.dbRef=_firebase.default.firestore().collection('groups');_this.state={uid:'',displayName:'',dialogVisible:false,groupname:'',groupArr:[],keyGroupCurrent:''};return _this;}(0,_createClass2.default)(Dashboard,[{key:"storeGroup",value:function storeGroup(){var _this2=this;if(this.state.groupname===''){alert('Fill at least your name!');}else{this.setState({isLoading:true});this.dbRef.add({groupname:this.state.groupname,userid:this.state.uid,timestamp:_firebase.default.firestore.FieldValue.serverTimestamp()}).then(function(res){_this2.refreshGroup();}).catch(function(err){console.error('Error found: ',err);_this2.setState({isLoading:false});});}}},{key:"componentDidMount",value:function componentDidMount(){this.setState({displayName:_firebase.default.auth().currentUser.displayName,uid:_firebase.default.auth().currentUser.uid});}},{key:"componentWillUnmount",value:function componentWillUnmount(){}},{key:"refreshGroup",value:function refreshGroup(){var _this3=this;this.getGroupByUserId(this.state.uid).then(function(groups){_this3.setState({groupArr:groups});});}},{key:"render",value:function render(){var _this4=this;return _react.default.createElement(_reactNative.SafeAreaView,{style:{flex:1,backgroundColor:'#424F61'},__source:{fileName:_jsxFileName,lineNumber:179,columnNumber:13}},_react.default.createElement(_reactNative.View,{style:styles.screenContainer,__source:{fileName:_jsxFileName,lineNumber:180,columnNumber:17}},_react.default.createElement(_headercomponent.default,{title:this.state.displayName,iconLeft:"user",iconRight:"search1",__source:{fileName:_jsxFileName,lineNumber:183,columnNumber:21}}),_react.default.createElement(_reactNative.ScrollView,{__source:{fileName:_jsxFileName,lineNumber:196,columnNumber:21}},_react.default.createElement(_reactNative.View,{style:styles.bodyContainer,__source:{fileName:_jsxFileName,lineNumber:197,columnNumber:25}},_react.default.createElement(_reactNative.TouchableOpacity,{style:styles.itemContainer,onPress:function onPress(){_this4.props.navigation.navigate('TaskCalendar',{userid:_this4.state.uid});},__source:{fileName:_jsxFileName,lineNumber:198,columnNumber:29}},_react.default.createElement(_Entypo.default,{name:'light-up',size:30,color:"#1e1e1e",__source:{fileName:_jsxFileName,lineNumber:209,columnNumber:33}}),_react.default.createElement(_reactNative.Text,{style:[styles.itemText,{marginLeft:20}],__source:{fileName:_jsxFileName,lineNumber:214,columnNumber:33}},"Xem c\xF4ng vi\u1EC7c theo ng\xE0y"),_react.default.createElement(_FontAwesome.default,{name:"angle-right",size:26,color:"#1e1e1e",__source:{fileName:_jsxFileName,lineNumber:222,columnNumber:33}})),_react.default.createElement(_reactNative.View,{style:styles.seperator,__source:{fileName:_jsxFileName,lineNumber:228,columnNumber:29}}),_react.default.createElement(ProfileItem,{icon:"calendar-today",name:"Xem c\xF4ng vi\u1EC7c theo tu\u1EA7n",onPress:function onPress(){_this4.props.navigation.navigate('Calendarscreen',{userid:_this4.state.uid});},__source:{fileName:_jsxFileName,lineNumber:229,columnNumber:29}}),_react.default.createElement(_reactNative.View,{style:styles.seperator,__source:{fileName:_jsxFileName,lineNumber:242,columnNumber:29}}),_react.default.createElement(ProfileItem,{icon:"chart-line",name:"Xem th\u1ED1ng k\xEA",__source:{fileName:_jsxFileName,lineNumber:243,columnNumber:29}}),_react.default.createElement(_reactNativeActionsheet.default,{ref:function ref(o){return _this4.ActionSheet=o;},title:'Dữ liệu sẽ bị xoá vĩnh viễn!',options:['Xoá danh sách','Huỷ bỏ'],cancelButtonIndex:1,destructiveButtonIndex:0,onPress:function onPress(index){if(index==0){_this4.deleteGroup(_this4.state.keyGroupCurrent);console.log(_this4.state.keyGroupCurrent);}},__source:{fileName:_jsxFileName,lineNumber:272,columnNumber:29}}),_react.default.createElement(_reactNative.View,{style:styles.divider,__source:{fileName:_jsxFileName,lineNumber:288,columnNumber:29}}),_react.default.createElement(_reactNative.TouchableOpacity,{style:styles.itemContainer,onPress:function onPress(){return _this4.signOut();},__source:{fileName:_jsxFileName,lineNumber:289,columnNumber:29}},_react.default.createElement(_reactNative.Text,{style:styles.itemText,__source:{fileName:_jsxFileName,lineNumber:293,columnNumber:33}},"\u0110\u0103ng xu\u1EA5t")))),_react.default.createElement(_reactNative.TouchableOpacity,{style:styles.itemContainer,onPress:function onPress(){_this4.props.navigation.navigate('Addtask',{userid:_this4.state.uid});},__source:{fileName:_jsxFileName,lineNumber:298,columnNumber:21}},_react.default.createElement(_MaterialCommunityIcons.default,{name:"shape-square-plus",size:30,color:"gray",__source:{fileName:_jsxFileName,lineNumber:306,columnNumber:25}}),_react.default.createElement(_reactNative.Text,{style:[styles.itemText,{marginLeft:20,color:'gray'}],__source:{fileName:_jsxFileName,lineNumber:311,columnNumber:25}},"Th\xEAm m\u1EDBi c\xF4ng vi\u1EC7c",' ')),_react.default.createElement(_reactNativeDialog.default.Container,{visible:this.state.dialogVisible,__source:{fileName:_jsxFileName,lineNumber:321,columnNumber:21}},_react.default.createElement(_reactNativeDialog.default.Title,{__source:{fileName:_jsxFileName,lineNumber:322,columnNumber:25}},"Danh s\xE1ch m\u1EDBi"),_react.default.createElement(_reactNativeDialog.default.Input,{placeholder:"Nh\u1EADp t\xEAn danh s\xE1ch",onChangeText:function onChangeText(text){console.log(text);_this4.setState({groupname:text});},__source:{fileName:_jsxFileName,lineNumber:323,columnNumber:25}}),_react.default.createElement(_reactNativeDialog.default.Button,{label:"Hu\u1EF7 ",onPress:this.handleCancel,__source:{fileName:_jsxFileName,lineNumber:330,columnNumber:25}}),_react.default.createElement(_reactNativeDialog.default.Button,{label:"L\u01B0u",onPress:this.handleSave,__source:{fileName:_jsxFileName,lineNumber:334,columnNumber:25}}))));}}]);return Dashboard;}(_react.Component);exports.default=Dashboard;var styles=_reactNative.StyleSheet.create({screenContainer:{flex:1},bodyContainer:{flex:1},userContainer:{backgroundColor:'#fff',flexDirection:'row',paddingHorizontal:20,paddingVertical:22,alignItems:'center'},avatarContainer:{width:50,height:50,borderRadius:25,alignItems:'center',justifyContent:'center',backgroundColor:'#1e88e5'},textContainer:{flex:1,marginLeft:20},welcomeText:{color:'#828282'},authText:{color:'#1e88e5',fontSize:18,fontWeight:'500'},itemContainer:{backgroundColor:'#fff',flexDirection:'row',paddingHorizontal:20,paddingVertical:15,alignItems:'center'},itemText:{flex:1,color:'#1e1e1e',fontSize:22},divider:{height:5},seperator:{height:0.5,width:'100%',backgroundColor:'#979797',alignSelf:'center'}});